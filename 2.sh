#!/bin/bash

# Проверка наличия аргумента
if [ -z "$1" ]; then
    echo "Использование: $0 <файл>"
    exit 1
fi

# Проверка существования файла
if [ ! -e "$1" ]; then
    echo "Ошибка: файл $1 не существует."
    exit 1
fi

# Получаем inode заданного файла
inode=$(ls -i "$1" | awk '{print $1}')

# Проверяем, найден ли inode
if [ -z "$inode" ]; then
    echo "Ошибка: не удалось получить inode для файла $1"
    exit 1
fi

echo "Ищем жёсткие ссылки на файл $1 (inode: $inode)..."

# Рекурсивный поиск файлов с тем же inode в домашней директории
ls -liR ~ 2>/dev/null | awk -v inode="$inode" '
    # Если строка начинается с пути, сохраняем его
    /^\// {
        dir = $0
        sub(/:$/, "", dir)  # Убираем двоеточие в конце
    }
    # Если строка содержит inode, выводим полный путь
    $1 == inode {
        print dir "/" $NF
    }
'